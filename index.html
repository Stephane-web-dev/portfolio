<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MathGPT Pro 2.0 â€“ by T.R.S</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjs@11.8.0/lib/browser/math.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/function-plot@1.23.1/dist/function-plot.min.js"></script>
  <style>
    body { margin: 0; font-family: sans-serif; background: #0d1117; color: #c9d1d9; display: flex; flex-direction: column; height: 100vh; }
    header { display: flex; justify-content: space-between; padding: 10px 20px; background: #161b22; align-items: center; }
    header .logo { font-weight: bold; font-size: 18px; }
    .controls button { background: none; border: none; font-size: 18px; margin-left: 10px; color: white; cursor: pointer; }
    .chat-window { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
    .message { padding: 10px; border-radius: 10px; max-width: 80%; white-space: pre-wrap; line-height: 1.4; font-size: 14px; }
    .user { align-self: flex-end; background: #238636; color: black; }
    .bot { align-self: flex-start; background: #30363d; }
    form { display: flex; padding: 15px; background: #161b22; }
    input { flex: 1; padding: 10px; border-radius: 6px; border: none; margin-right: 10px; background: #0d1117; color: white; }
    button[type="submit"] { background: #238636; border: none; color: white; padding: 10px 15px; border-radius: 6px; cursor: pointer; }
    #plot { background: white; border-radius: 8px; padding: 10px; margin-top: 10px; }
    @media (max-width: 600px) {
      .chat-window { padding: 10px; }
      input, button[type="submit"] { font-size: 14px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">ğŸ“˜ MathGPT Pro 2.0</div>
    <div class="controls">
      <button id="themeToggle">ğŸŒ™</button>
      <button id="langSwitch">ğŸ‡¬ğŸ‡§</button>
    </div>
  </header>
  <main class="chat-window" id="chat"></main>
  <form id="chatForm">
    <input type="text" id="chatInput" placeholder="Type your math problem..." required />
    <button type="submit">Send</button>
  </form>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const chat = document.getElementById("chat");
      const chatForm = document.getElementById("chatForm");
      const chatInput = document.getElementById("chatInput");
      const themeToggle = document.getElementById("themeToggle");
      const langSwitch = document.getElementById("langSwitch");
      let currentLang = "en";
      const T = {
        en: { placeholder: "Type your math problem...", fail: "âŒ Cannot solve this.", result: "âœ… Result:", copied: "ğŸ“‹ Copied!" },
        fr: { placeholder: "Tapez votre problÃ¨me...", fail: "âŒ Impossible de rÃ©soudre.", result: "âœ… RÃ©sultat:", copied: "ğŸ“‹ CopiÃ© !" }
      };

      function renderMath(el) {
        renderMathInElement(el, { delimiters: [{ left: "$$", right: "$$", display: true }] });
      }

      function addMessage(msg, isUser) {
        const div = document.createElement("div");
        div.className = `message ${isUser ? 'user' : 'bot'}`;
        div.innerHTML = msg;
        chat.appendChild(div);
        renderMath(div);
        chat.scrollTop = chat.scrollHeight;
      }

      function trySolve(input) {
        try {
          if (input.startsWith("solve(")) {
            const expr = input.slice(6, -1);
            const sol = math.solve(expr, 'x');
            return `ğŸ” <b>Solutions:</b><br>$$${sol.toString()}$$`;
          } else if (input.startsWith("derive(")) {
            const expr = input.slice(7, -1);
            return `ğŸ“ <b>Derivative:</b><br>$$${math.derivative(expr, 'x').toString()}$$`;
          } else if (input.startsWith("integrate(")) {
            const expr = input.slice(10, -1);
            return `ğŸ§® <b>Integral:</b><br>$$\int ${expr} dx$$`;
          } else if (input.startsWith("plot(")) {
            const expr = input.slice(5, -1);
            const container = document.createElement("div");
            container.id = "plot";
            chat.appendChild(container);
            functionPlot({ target: "#plot", width: 350, height: 250, grid: true, data: [{ fn: expr }] });
            return `ğŸ“Š <b>Graph:</b> $$y = ${expr}$$`;
          } else {
            const simplified = math.simplify(input);
            const result = math.evaluate(input);
            return `ğŸ” <b>Simplified:</b><br>$$${simplified}$$<br><br>${T[currentLang].result} <br>$$${result}$$`;
          }
        } catch (e) {
          return T[currentLang].fail;
        }
      }

      chatForm.onsubmit = e => {
        e.preventDefault();
        const input = chatInput.value.trim();
        if (!input) return;
        addMessage(input, true);
        chatInput.value = "";
        setTimeout(() => addMessage(trySolve(input), false), 500);
      };

      themeToggle.onclick = () => {
        document.body.classList.toggle("light");
        document.body.classList.toggle("dark");
        themeToggle.textContent = document.body.classList.contains("light") ? "â˜€ï¸" : "ğŸŒ™";
      };

      langSwitch.onclick = () => {
        currentLang = currentLang === "en" ? "fr" : "en";
        langSwitch.textContent = currentLang === "en" ? "ğŸ‡¬ğŸ‡§" : "ğŸ‡«ğŸ‡·";
        chatInput.placeholder = T[currentLang].placeholder;
      };
    });
  </script>
</body>
</html>
